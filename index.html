<!DOCTYPE html><html lang="ko" data-theme="default"> <head> <meta charset="UTF-8"> <title>다크 테마 메모장</title> <!-- MathJax 라이브러리 추가 --> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <style> /* 기본 스타일 */ :root { --bg-color: #FFFFFF; --text-color: #333333; --accent-color: #4A90E2; --border-color: #DDDDDD; --toolbar-bg: #F5F5F5; --font-family: 'Arial', sans-serif; }
        /* 테마 정의 */
    [data-theme="default"] {
        --bg-color: #222222;
        --text-color: #E0D268;
        --accent-color: #E0D268;
        --border-color: #E0D268;
        --toolbar-bg: #333333;
    }
    
    [data-theme="midnight"] {
        --bg-color: #121212;
        --text-color: #A8DADC;
        --accent-color: #004D61;
        --border-color: #004D61;
        --toolbar-bg: #1A1A1A;
    }
    
    [data-theme="forest"] {
        --bg-color: #1A1A1A;
        --text-color: #E4E4E4;
        --accent-color: #3E5641;
        --border-color: #3E5641;
        --toolbar-bg: #222222;
    }
    
    [data-theme="twilight"] {
        --bg-color: #2C2C2C;
        --text-color: #B39CD0;
        --accent-color: #FFC1CC;
        --border-color: #FFC1CC;
        --toolbar-bg: #333333;
    }
    
    [data-theme="warm"] {
        --bg-color: #1C1C1C;
        --text-color: #F5E8D8;
        --accent-color: #DAA520;
        --border-color: #DAA520;
        --toolbar-bg: #2A2A2A;
    }
    
    [data-theme="emerald"] {
        --bg-color: #222222;
        --text-color: #A9DFBF;
        --accent-color: #4A5E3D;
        --border-color: #4A5E3D;
        --toolbar-bg: #2E2E2E;
    }
    
    /* 기본 스타일 적용 */
    body { 
        font-family: var(--font-family);
        margin: 40px; 
        background-color: var(--bg-color); 
        color: var(--text-color);
        transition: all 0.3s ease;
    }
    
    h2 {
        color: var(--text-color);
        border-bottom: 2px solid var(--accent-color);
        padding-bottom: 10px;
    }
    
    textarea { 
        width: 100%; 
        height: 400px; 
        font-size: 16px; 
        padding: 15px; 
        box-sizing: border-box; 
        background-color: var(--toolbar-bg); 
        color: var(--text-color); 
        border: 2px solid var(--border-color);
        border-radius: 5px;
        line-height: 1.5;
        font-family: inherit;
        resize: vertical;
    }
    
    textarea:focus {
        outline: none;
        box-shadow: 0 0 5px var(--accent-color);
    }
    
    button { 
        margin: 5px; 
        padding: 8px 15px; 
        font-size: 14px; 
        background-color: var(--toolbar-bg); 
        color: var(--text-color); 
        border: 2px solid var(--border-color); 
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    button:hover {
        background-color: var(--accent-color);
        color: var(--bg-color);
    }
    
    .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 15px;
    }
    
    .toolbar {
        background-color: var(--toolbar-bg);
        padding: 10px;
        border: 2px solid var(--border-color);
        border-radius: 5px;
        margin-bottom: 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .toolbar button {
        margin: 2px;
        padding: 5px 10px;
    }
    
    .color-picker {
        height: 30px;
        width: 30px;
        padding: 0;
        border: 2px solid var(--border-color);
        border-radius: 5px;
        background-color: transparent;
        cursor: pointer;
    }
    
    .font-size, .font-family {
        background-color: var(--toolbar-bg);
        color: var(--text-color);
        border: 2px solid var(--border-color);
        border-radius: 5px;
        padding: 5px;
    }
    
    .separator {
        width: 1px;
        height: 30px;
        background-color: var(--border-color);
        margin: 0 5px;
    }
    
    .active {
        background-color: var(--accent-color);
        color: var(--bg-color);
    }
    
    .theme-selector {
        margin-bottom: 15px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .theme-btn {
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
    }
    
    .status-bar {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 12px;
        padding: 5px 10px;
        border-radius: 5px;
        background-color: var(--toolbar-bg);
        color: var(--text-color);
        border: 1px solid var(--border-color);
    }
    
    .fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
        background-color: var(--bg-color);
    }
    
    .fullscreen textarea {
        height: calc(100vh - 150px);
    }
    
    .fullscreen-controls {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 10000;
        display: none;
    }
    
    .fullscreen .fullscreen-controls {
        display: block;
    }
    
    .search-container {
        display: flex;
        margin-top: 10px;
        gap: 5px;
        margin-bottom: 10px;
    }
    
    .search-container input {
        flex-grow: 1;
        padding: 8px;
        border-radius: 5px;
        border: 2px solid var(--border-color);
        background-color: var(--toolbar-bg);
        color: var(--text-color);
    }
    
    .note-list {
        display: none;
        margin-top: 15px;
        max-height: 200px;
        overflow-y: auto;
        padding: 10px;
        border-radius: 5px;
        background-color: var(--toolbar-bg);
        border: 2px solid var(--border-color);
    }
    
    .note-item {
        padding: 8px;
        margin-bottom: 5px;
        border-radius: 3px;
        cursor: pointer;
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .note-item:hover {
        background-color: var(--accent-color);
        color: var(--bg-color);
    }
    
    /* 수식 관련 스타일 */
    .math-preview {
        background-color: var(--toolbar-bg);
        padding: 10px;
        border: 2px solid var(--border-color);
        border-radius: 5px;
        margin-top: 10px;
        display: none;
    }
    
    .math-toolbar {
        background-color: var(--toolbar-bg);
        padding: 10px;
        border: 2px solid var(--border-color);
        border-radius: 5px;
        margin-top: 10px;
        display: none;
        flex-wrap: wrap;
        gap: 5px;
    }
    
    /* 그림 관련 스타일 */
    #drawing-canvas {
        background-color: white;
        border: 2px solid var(--border-color);
        border-radius: 5px;
        display: none;
        cursor: crosshair;
    }
    
    .drawing-toolbar {
        background-color: var(--toolbar-bg);
        padding: 10px;
        border: 2px solid var(--border-color);
        border-radius: 5px;
        margin-top: 10px;
        display: none;
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .color-btn {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        border: 2px solid var(--border-color);
        cursor: pointer;
    }
    
    .color-btn.active {
        border: 2px solid white;
    }
    
    .modal {
        display: none;
        position: fixed;
        z-index: 10001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
    }
    
    .modal-content {
        background-color: var(--bg-color);
        margin: 10% auto;
        padding: 20px;
        border: 2px solid var(--border-color);
        border-radius: 5px;
        width: 80%;
        max-width: 600px;
    }
    
    .close {
        color: var(--text-color);
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .close:hover {
        color: var(--accent-color);
    }
</style>
</head> <body> <div id="main-container"> <h2>메모장</h2>
    <div class="theme-selector">
        <button class="theme-btn" onclick="changeTheme('default')">기본 테마</button>
        <button class="theme-btn" onclick="changeTheme('midnight')">미드나이트 블루</button>
        <button class="theme-btn" onclick="changeTheme('forest')">딥 포레스트</button>
        <button class="theme-btn" onclick="changeTheme('twilight')">트와일라잇</button>
        <button class="theme-btn" onclick="changeTheme('warm')">웜 톤</button>
        <button class="theme-btn" onclick="changeTheme('emerald')">에메랄드</button>
    </div>
    
    <div class="toolbar">
        <button id="bold" onclick="formatText('bold')" title="굵게"><b>B</b></button>
        <button id="italic" onclick="formatText('italic')" title="기울임"><i>I</i></button>
        <button id="underline" onclick="formatText('underline')" title="밑줄"><u>U</u></button>
        <button id="strikethrough" onclick="formatText('strikethrough')" title="취소선"><s>S</s></button>
        
        <div class="separator"></div>
        
        <button onclick="formatText('heading1')" title="제목 1">H1</button>
        <button onclick="formatText('heading2')" title="제목 2">H2</button>
        <button onclick="formatText('heading3')" title="제목 3">H3</button>
        
        <div class="separator"></div>
        
        <button onclick="formatText('list')" title="목록">-  목록</button>
        <button onclick="formatText('numberedList')" title="번호 목록">1. 번호</button>
        
        <div class="separator"></div>
        
        <select class="font-size" onchange="changeFont(this.value)" title="글꼴 크기">
            <option value="">글꼴 크기</option>
            <option value="small">작게</option>
            <option value="medium">보통</option>
            <option value="large">크게</option>
            <option value="x-large">매우 크게</option>
        </select>
        
        <select class="font-family" onchange="changeFontFamily(this.value)" title="글꼴">
            <option value="">글꼴</option>
            <option value="Arial, sans-serif">Arial</option>
            <option value="'Times New Roman', serif">Times New Roman</option>
            <option value="'Courier New', monospace">Courier New</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="Verdana, sans-serif">Verdana</option>
            <option value="'Nanum Gothic', sans-serif">나눔 고딕</option>
            <option value="'Malgun Gothic', sans-serif">맑은 고딕</option>
        </select>
        
        <div class="separator"></div>
        
        <input type="color" value="#E0D268" class="color-picker" onchange="changeColor(this.value)" title="글자 색상">
        <button onclick="resetColor()" title="기본 색상으로 복원">기본색</button>
        
        <div class="separator"></div>
        
        <button onclick="insertDateTime()" title="날짜/시간 삽입">날짜/시간</button>
        <button onclick="toggleFullscreen()" title="전체 화면 모드">전체화면</button>
        
        <div class="separator"></div>
        
        <!-- 수식 및 그림 관련 버튼 추가 -->
        <button onclick="toggleMathInput()" title="수식 입력">수식</button>
        <button onclick="toggleDrawingCanvas()" title="그림 그리기">그림</button>
    </div>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="메모 내용 검색...">
        <button onclick="searchText()">검색</button>
        <button onclick="clearSearch()">지우기</button>
    </div>
    
    <div id="note-list" class="note-list"></div>
    
    <textarea id="notepad" placeholder="여기에 메모를 입력하세요..." oninput="autoSave(); updateWordCount();"></textarea>
    
    <!-- 수식 입력 관련 요소 -->
    <div id="math-toolbar" class="math-toolbar">
        <button onclick="insertMathSymbol('\\alpha')">α</button>
        <button onclick="insertMathSymbol('\\beta')">β</button>
        <button onclick="insertMathSymbol('\\gamma')">γ</button>
        <button onclick="insertMathSymbol('\\delta')">δ</button>
        <button onclick="insertMathSymbol('\\sum_{i=1}^{n}')">∑</button>
        <button onclick="insertMathSymbol('\\prod_{i=1}^{n}')">∏</button>
        <button onclick="insertMathSymbol('\\int_{a}^{b}')">∫</button>
        <button onclick="insertMathSymbol('\\frac{a}{b}')">a/b</button>
        <button onclick="insertMathSymbol('\\sqrt{x}')">√x</button>
        <button onclick="insertMathSymbol('x^{2}')">x²</button>
        <button onclick="insertMathSymbol('\\infty')">∞</button>
        <button onclick="insertMathSymbol('\\approx')">≈</button>
        <button onclick="insertMathSymbol('\\neq')">≠</button>
        <button onclick="insertMathSymbol('\\leq')">≤</button>
        <button onclick="insertMathSymbol('\\geq')">≥</button>
        <div class="separator"></div>
        <input type="text" id="math-input" placeholder="LaTeX 수식 입력..." style="flex-grow: 1;">
        <button onclick="previewMath()">미리보기</button>
        <button onclick="insertMath()">삽입</button>
    </div>
    
    <div id="math-preview" class="math-preview"></div>
    
    <!-- 그림 그리기 관련 요소 -->
    <canvas id="drawing-canvas" width="800" height="400"></canvas>
    
    <div id="drawing-toolbar" class="drawing-toolbar">
        <div style="display: flex; align-items: center; gap: 5px;">
            <label>선 두께:</label>
            <input type="range" id="brush-size" min="1" max="50" value="5" oninput="updateBrushSize(this.value)">
            <span id="brush-size-value">5px</span>
        </div>
        <div class="separator"></div>
        <div style="display: flex; align-items: center; gap: 5px;">
            <label>색상:</label>
            <div class="color-btn active" style="background-color: black;" onclick="selectColor('black', this)"></div>
            <div class="color-btn" style="background-color: red;" onclick="selectColor('red', this)"></div>
            <div class="color-btn" style="background-color: green;" onclick="selectColor('green', this)"></div>
            <div class="color-btn" style="background-color: blue;" onclick="selectColor('blue', this)"></div>
            <div class="color-btn" style="background-color: yellow;" onclick="selectColor('yellow', this)"></div>
            <input type="color" id="custom-color" onchange="selectColor(this.value, this)" title="사용자 정의 색상">
        </div>
        <div class="separator"></div>
        <button onclick="clearCanvas()">지우기</button>
        <button onclick="insertDrawing()">삽입</button>
        <button onclick="cancelDrawing()">취소</button>
    </div>
    
    <div class="fullscreen-controls">
        <button onclick="toggleFullscreen()">전체화면 종료</button>
    </div>
    
    <div class="status-bar">
        <span id="wordCount">글자 수: 0 | 단어 수: 0 | 줄 수: 0</span>
        <span id="lastSaved">마지막 저장: -</span>
    </div>
    
    <div class="button-container">
        <button onclick="saveNote()">저장</button>
        <button onclick="loadNote()">불러오기</button>
        <button onclick="clearNote()">지우기</button>
        <button onclick="downloadNote()">다운로드</button>
        <button onclick="copyToClipboard()">클립보드에 복사</button>
        <button onclick="createNewNote()">새 메모</button>
        <button onclick="toggleNoteList()">메모 목록</button>
    </div>
</div>

<!-- 수식 템플릿 모달 -->
<div id="math-modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeMathModal()">&times;</span>
        <h3>수식 템플릿</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
            <button onclick="insertMathTemplate('quadratic')">이차방정식</button>
            <button onclick="insertMathTemplate('pythagoras')">피타고라스</button>
            <button onclick="insertMathTemplate('derivative')">미분</button>
            <button onclick="insertMathTemplate('integral')">적분</button>
            <button onclick="insertMathTemplate('matrix')">행렬</button>
            <button onclick="insertMathTemplate('limit')">극한</button>
            <button onclick="insertMathTemplate('series')">급수</button>
            <button onclick="insertMathTemplate('vector')">벡터</button>
        </div>
    </div>
</div>

<script>
    // 전역 변수
    let currentNoteId = 'default';
    let autoSaveTimer;
    let notes = {};
    let isFullscreen = false;
    let currentDrawingColor = 'black';
    let currentBrushSize = 5;
    let isDrawing = false;
    let mathTemplates = {
        quadratic: "\$$ x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} \$$",
        pythagoras: "\$$ a^2 + b^2 = c^2 \$$",
        derivative: "\$$ \\frac{d}{dx}f(x) = \\lim_{h \\to 0}\\frac{f(x+h) - f(x)}{h} \$$",
        integral: "\$$ \\int_{a}^{b} f(x) \\, dx = F(b) - F(a) \$$",
        matrix: "\$$ \\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix} \$$",
        limit: "\$$ \\lim_{x \\to a} f(x) = L \$$",
        series: "\$$ \\sum_{n=0}^{\\infty} a_n x^n \$$",
        vector: "\$$ \\vec{v} = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} \$$"
    };
    
    // 페이지 로드 전에 테마 적용 (깜빡임 방지)
    (function() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
        }
    })();
    
    // 테마 변경 함수
    function changeTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
        console.log('테마 변경:', theme);
    }
    
    // 자동 저장 기능
    function autoSave() {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(function() {
            saveNote(true); // true는 자동 저장임을 나타냄
        }, 3000); // 3초 후 자동 저장
    }
    
    // 저장 함수
    function saveNote(isAuto = false) {
        const content = document.getElementById('notepad').value;
        
        // 현재 메모 저장
        notes[currentNoteId] = {
            content: content,
            lastModified: new Date().toLocaleString()
        };
        
        // 모든 메모 저장
        localStorage.setItem('notes', JSON.stringify(notes));
        
        // 메모 ID 목록 저장
        localStorage.setItem('noteIds', JSON.stringify(Object.keys(notes)));
        
        // 현재 메모 ID 저장
        localStorage.setItem('currentNoteId', currentNoteId);
        
        // 상태 표시줄 업데이트
        updateLastSaved(isAuto);
    }
    
    // 마지막 저장 시간 업데이트
    function updateLastSaved(isAuto) {
        const now = new Date().toLocaleString();
        document.getElementById('lastSaved').textContent = 
            '마지막 저장: ' + now + (isAuto ? ' (자동)' : '');
    }
    
    // 불러오기 함수
    function loadNote() {
        // 모든 메모 불러오기
        const savedNotes = localStorage.getItem('notes');
        if (savedNotes) {
            notes = JSON.parse(savedNotes);
            
            // 현재 메모 ID 불러오기
            const savedCurrentNoteId = localStorage.getItem('currentNoteId');
            if (savedCurrentNoteId) {
                currentNoteId = savedCurrentNoteId;
            }
            
            // 현재 메모 내용 표시
            if (notes[currentNoteId]) {
                const content = notes[currentNoteId].content;
                document.getElementById('notepad').value = content;
                
                updateWordCount();
                alert('메모를 불러왔습니다!');
            } else {
                alert('저장된 메모가 없습니다.');
            }
        } else {
            alert('저장된 메모가 없습니다.');
        }
        
        // 메모 목록 업데이트
        updateNoteList();
    }
    
    // 메모 지우기
    function clearNote() {
        if(confirm('정말로 메모를 지우시겠습니까?')) {
            document.getElementById('notepad').value = '';
            updateWordCount();
        }
    }
    
    // 다운로드 함수
    function downloadNote() {
        const text = document.getElementById('notepad').value;
            
        if (!text) {
            alert('다운로드할 내용이 없습니다.');
            return;
        }
        
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        
        const filename = prompt('파일 이름을 입력하세요:', 'memo.txt');
        if (!filename) return; // 취소 시 중단
        
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }
    
    // 클립보드에 복사
    function copyToClipboard() {
        const textarea = document.getElementById('notepad');
            
        textarea.select();
        document.execCommand('copy');
        alert('클립보드에 복사되었습니다!');
    }
    
    // 텍스트 서식 지정
    function formatText(format) {
        const textarea = document.getElementById('notepad');
            
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);
        let formattedText = '';
        
        switch(format) {
            case 'bold':
                formattedText = `**${selectedText}**`;
                break;
            case 'italic':
                formattedText = `*${selectedText}*`;
                break;
            case 'underline':
                formattedText = `_${selectedText}_`;
                break;
            case 'strikethrough':
                formattedText = `~~${selectedText}~~`;
                break;
            case 'heading1':
                formattedText = `\n# ${selectedText}\n`;
                break;
            case 'heading2':
                formattedText = `\n## ${selectedText}\n`;
                break;
            case 'heading3':
                formattedText = `\n### ${selectedText}\n`;
                break;
            case 'list':
                formattedText = selectedText.split('\n').map(line => `-  ${line}`).join('\n');
                break;
            case 'numberedList':
                formattedText = selectedText.split('\n').map((line, index) => `${index + 1}. ${line}`).join('\n');
                break;
        }
        
        textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
        textarea.focus();
        textarea.selectionStart = start;
        textarea.selectionEnd = start + formattedText.length;
        
        // 버튼 활성화 상태 토글
        toggleButtonState(format);
        
        // 자동 저장 및 단어 수 업데이트
        autoSave();
        updateWordCount();
    }
    
    // 버튼 상태 토글
    function toggleButtonState(format) {
        const button = document.getElementById(format);
        if (button) {
            button.classList.toggle('active');
            setTimeout(() => {
                button.classList.remove('active');
            }, 300);
        }
    }
    
    // 글꼴 크기 변경
    function changeFont(size) {
        const textarea = document.getElementById('notepad');
            
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);
        
        if (!selectedText) {
            alert('글꼴 크기를 변경할 텍스트를 먼저 선택하세요.');
            return;
        }
        
        let sizeTag = '';
        switch(size) {
            case 'small':
                sizeTag = '<small>';
                break;
            case 'medium':
                sizeTag = '<medium>';
                break;
            case 'large':
                sizeTag = '<large>';
                break;
            case 'x-large':
                sizeTag = '<x-large>';
                break;
            default:
                return;
        }
        
        const formattedText = `${sizeTag}${selectedText}</${size}>`;
        textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
        textarea.focus();
        
        // 자동 저장 및 단어 수 업데이트
        autoSave();
        updateWordCount();
    }
    
    // 글꼴 변경
    function changeFontFamily(fontFamily) {
        const textarea = document.getElementById('notepad');
        
        if (fontFamily) {
            document.documentElement.style.setProperty('--font-family', fontFamily);
            localStorage.setItem('fontFamily', fontFamily);
        }
    }
    
    // 색상 변경
    function changeColor(color) {
        const textarea = document.getElementById('notepad');
            
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);
        
        if (!selectedText) {
            alert('색상을 변경할 텍스트를 먼저 선택하세요.');
            return;
        }
        
        const formattedText = `<color=${color}>${selectedText}</color>`;
        textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
        textarea.focus();
        
        // 자동 저장 및 단어 수 업데이트
        autoSave();
        updateWordCount();
    }
    
    // 색상 초기화
    function resetColor() {
        const textarea = document.getElementById('notepad');
            
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);
        
        if (!selectedText) {
            alert('색상을 초기화할 텍스트를 먼저 선택하세요.');
            return;
        }
        
        // 색상 태그 제거
        const regex = /<color=[^>]+>(.+?)<\/color>/g;
        const formattedText = selectedText.replace(regex, '$1');
        
        textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
        textarea.focus();
        
        // 자동 저장 및 단어 수 업데이트
        autoSave();
        updateWordCount();
    }
    
    // 날짜/시간 삽입
    function insertDateTime() {
        const textarea = document.getElementById('notepad');
            
        const cursorPos = textarea.selectionStart;
        const now = new Date().toLocaleString();
        const dateTimeText = `[${now}] `;
        
        textarea.value = 
            textarea.value.substring(0, cursorPos) + 
            dateTimeText + 
            textarea.value.substring(cursorPos);
            
        textarea.focus();
        textarea.selectionStart = cursorPos + dateTimeText.length;
        textarea.selectionEnd = cursorPos + dateTimeText.length;
        
        // 자동 저장 및 단어 수 업데이트
        autoSave();
        updateWordCount();
    }
    
    // 전체 화면 모드 토글
    function toggleFullscreen() {
        const container = document.getElementById('main-container');
        
        if (isFullscreen) {
            // 전체 화면 종료
            container.classList.remove('fullscreen');
            document.body.style.overflow = 'auto';
            isFullscreen = false;
        } else {
            // 전체 화면 시작
            container.classList.add('fullscreen');
            document.body.style.overflow = 'hidden';
            isFullscreen = true;
            document.getElementById('notepad').focus();
        }
    }
    
    // 단어 수 및 줄 수 업데이트
    function updateWordCount() {
        const text = document.getElementById('notepad').value;
            
        const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
        const lineCount = text === '' ? 0 : text.split('\n').length;
        
        document.getElementById('wordCount').textContent = 
            `글자 수: ${text.length} | 단어 수: ${wordCount} | 줄 수: ${lineCount}`;
    }
    
    // 새 메모 생성
    function createNewNote() {
        const noteTitle = prompt('새 메모의 제목을 입력하세요:');
        if (!noteTitle) return;
        
        const noteId = 'note_' + Date.now();
        notes[noteId] = {
            title: noteTitle,
            content: '',
            lastModified: new Date().toLocaleString()
        };
        
        currentNoteId = noteId;
        
        // 메모장 비우기
        document.getElementById('notepad').value = '';
        
        updateWordCount();
        saveNote();
        updateNoteList();
    }
    
    // 메모 목록 토글
    function toggleNoteList() {
        const noteList = document.getElementById('note-list');
        
        if (noteList.style.display === 'block') {
            noteList.style.display = 'none';
        } else {
            noteList.style.display = 'block';
            updateNoteList();
        }
    }
    
    // 메모 목록 업데이트
    function updateNoteList() {
        const noteList = document.getElementById('note-list');
        noteList.innerHTML = '';
        
        for (const noteId in notes) {
            const note = notes[noteId];
            const noteItem = document.createElement('div');
            noteItem.className = 'note-item';
            noteItem.textContent = note.title || `메모 ${noteId.substring(5)}`;
            noteItem.onclick = function() {
                loadSpecificNote(noteId);
            };
            
            if (noteId === currentNoteId) {
                noteItem.style.fontWeight = 'bold';
            }
            
            noteList.appendChild(noteItem);
        }
    }
    
    // 특정 메모 불러오기
    function loadSpecificNote(noteId) {
        if (notes[noteId]) {
            currentNoteId = noteId;
            
            const content = notes[noteId].content;
            document.getElementById('notepad').value = content;
            
            updateWordCount();
            updateNoteList();
        }
    }
    
    // 메모 내용 검색
    function searchText() {
        const searchTerm = document.getElementById('searchInput').value.trim();
        if (!searchTerm) {
            alert('검색어를 입력하세요.');
            return;
        }
        
        const textarea = document.getElementById('notepad');
        const text = textarea.value;
        const index = text.indexOf(searchTerm);
        
        if (index !== -1) {
            textarea.focus();
            textarea.setSelectionRange(index, index + searchTerm.length);
        } else {
            alert('검색 결과가 없습니다.');
        }
    }
    
    // 검색 지우기
    function clearSearch() {
        document.getElementById('searchInput').value = '';
    }
    
    // 수식 입력 토글
    function toggleMathInput() {
        const mathToolbar = document.getElementById('math-toolbar');
        const mathPreview = document.getElementById('math-preview');
        const drawingCanvas = document.getElementById('drawing-canvas');
        const drawingToolbar = document.getElementById('drawing-toolbar');
        
        if (mathToolbar.style.display === 'flex') {
            mathToolbar.style.display = 'none';
            mathPreview.style.display = 'none';
        } else {
            mathToolbar.style.display = 'flex';
            mathPreview.style.display = 'block';
            drawingCanvas.style.display = 'none';
            drawingToolbar.style.display = 'none';
            
            // 수식 템플릿 모달 표시
            document.getElementById('math-modal').style.display = 'block';
        }
    }
    
    // 수식 템플릿 모달 닫기
    function closeMathModal() {
        document.getElementById('math-modal').style.display = 'none';
    }
    
    // 수식 기호 삽입
    function insertMathSymbol(symbol) {
        const mathInput = document.getElementById('math-input');
        const cursorPos = mathInput.selectionStart;
        
        mathInput.value = 
            mathInput.value.substring(0, cursorPos) + 
            symbol + 
            mathInput.value.substring(cursorPos);
            
        mathInput.focus();
        mathInput.selectionStart = cursorPos + symbol.length;
        mathInput.selectionEnd = cursorPos + symbol.length;
        
        previewMath();
    }
    
    // 수식 템플릿 삽입
    function insertMathTemplate(template) {
        document.getElementById('math-input').value = mathTemplates[template].replace(/\$$/g, '').replace(/\$$/g, '');
        previewMath();
        closeMathModal();
    }
    
    // 수식 미리보기
    function previewMath() {
        const mathInput = document.getElementById('math-input').value;
        const mathPreview = document.getElementById('math-preview');
        
        mathPreview.innerHTML = '\$$' + mathInput + '\$$';
        
        // MathJax로 수식 렌더링
        MathJax.typesetPromise([mathPreview]).catch(function (err) {
            console.log('MathJax 오류:', err);
        });
    }
    
    // 수식 삽입
    function insertMath() {
        const mathInput = document.getElementById('math-input').value;
        if (!mathInput) {
            alert('수식을 입력하세요.');
            return;
        }
        
        const textarea = document.getElementById('notepad');
        const cursorPos = textarea.selectionStart;
        const mathText = '\$$' + mathInput + '\$$';
        
        textarea.value = 
            textarea.value.substring(0, cursorPos) + 
            mathText + 
            textarea.value.substring(cursorPos);
            
        textarea.focus();
        textarea.selectionStart = cursorPos + mathText.length;
        textarea.selectionEnd = cursorPos + mathText.length;
        
        // 수식 입력 창 초기화
        document.getElementById('math-input').value = '';
        document.getElementById('math-preview').innerHTML = '';
        
        // 수식 입력 창 닫기
        document.getElementById('math-toolbar').style.display = 'none';
        document.getElementById('math-preview').style.display = 'none';
        
        // 자동 저장 및 단어 수 업데이트
        autoSave();
        updateWordCount();
    }
    
    // 그림 그리기 캔버스 토글
    function toggleDrawingCanvas() {
        const drawingCanvas = document.getElementById('drawing-canvas');
        const drawingToolbar = document.getElementById('drawing-toolbar');
        const mathToolbar = document.getElementById('math-toolbar');
        const mathPreview = document.getElementById('math-preview');
        
        if (drawingCanvas.style.display === 'block') {
            drawingCanvas.style.display = 'none';
            drawingToolbar.style.display = 'none';
        } else {
            drawingCanvas.style.display = 'block';
            drawingToolbar.style.display = 'flex';
            mathToolbar.style.display = 'none';
            mathPreview.style.display = 'none';
            
            // 캔버스 초기화
            initCanvas();
        }
    }
    
    // 캔버스 초기화
    function initCanvas() {
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        
        // 캔버스 배경을 흰색으로 설정
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 그리기 이벤트 리스너 설정
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        // 터치 이벤트 리스너 설정
        canvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const touch = e.touches;
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });
        
        canvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            const touch = e.touches;
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        });
        
        canvas.addEventListener('touchend', function(e) {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        });
    }
    
    // 그리기 시작
    function startDrawing(e) {
        isDrawing = true;
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineWidth = currentBrushSize;
        ctx.lineCap = 'round';
        ctx.strokeStyle = currentDrawingColor;
    }
    
    // 그리기
    function draw(e) {
        if (!isDrawing) return;
        
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        ctx.lineTo(x, y);
        ctx.stroke();
    }
    
    // 그리기 중지
    function stopDrawing() {
        isDrawing = false;
    }
    
    // 브러시 크기 업데이트
    function updateBrushSize(size) {
        currentBrushSize = size;
        document.getElementById('brush-size-value').textContent = size + 'px';
    }
    
    // 색상 선택
    function selectColor(color, element) {
        currentDrawingColor = color;
        
        // 활성 상태 업데이트
        const colorButtons = document.querySelectorAll('.color-btn');
        colorButtons.forEach(btn => btn.classList.remove('active'));
        
        if (element && element.classList.contains('color-btn')) {
            element.classList.add('active');
        }
    }
    
    // 캔버스 지우기
    function clearCanvas() {
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }
    
    // 그림 삽입
    function insertDrawing() {
        const canvas = document.getElementById('drawing-canvas');
        const imageData = canvas.toDataURL('image/png');
        
        const textarea = document.getElementById('notepad');
        const cursorPos = textarea.selectionStart;
        const imageTag = `\n<img src="${imageData}" alt="그림">\n`;
        
        textarea.value = 
            textarea.value.substring(0, cursorPos) + 
            imageTag + 
            textarea.value.substring(cursorPos);
            
        textarea.focus();
        textarea.selectionStart = cursorPos + imageTag.length;
        textarea.selectionEnd = cursorPos + imageTag.length;
        
        // 그림 그리기 창 닫기
        document.getElementById('drawing-canvas').style.display = 'none';
        document.getElementById('drawing-toolbar').style.display = 'none';
        
        // 자동 저장 및 단어 수 업데이트
        autoSave();
        updateWordCount();
    }
    
    // 그림 그리기 취소
    function cancelDrawing() {
        document.getElementById('drawing-canvas').style.display = 'none';
        document.getElementById('drawing-toolbar').style.display = 'none';
    }
    
    // 페이지 로드 시 초기화
    window.onload = function() {
        // 테마 불러오기
        var theme = localStorage.getItem('theme');
        if (theme !== null) {
            changeTheme(theme);
        }
        
        // 글꼴 불러오기
        var fontFamily = localStorage.getItem('fontFamily');
        if (fontFamily !== null) {
            document.documentElement.style.setProperty('--font-family', fontFamily);
        }
        
        // 메모 불러오기
        loadNote();
        
        // 단어 수 초기화
        updateWordCount();
        
        // 단축키 설정
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'b': // Ctrl+B: 굵게
                        e.preventDefault();
                        formatText('bold');
                        break;
                    case 'i': // Ctrl+I: 기울임
                        e.preventDefault();
                        formatText('italic');
                        break;
                    case 'u': // Ctrl+U: 밑줄
                        e.preventDefault();
                        formatText('underline');
                        break;
                    case 's': // Ctrl+S: 저장
                        e.preventDefault();
                        saveNote();
                        break;
                    case 'f': // Ctrl+F: 검색
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                        break;
                }
            } else if (e.key === 'F11') { // F11: 전체 화면
                e.preventDefault();
                toggleFullscreen();
            } else if (e.key === 'Escape' && isFullscreen) { // ESC: 전체 화면 종료
                e.preventDefault();
                toggleFullscreen();
            }
        });
    }
</script>
</body> </html>
