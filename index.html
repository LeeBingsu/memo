<!DOCTYPE html>
<html lang="ko" data-theme="default">
<head>
    <meta charset="UTF-8">
    <title>ë‹¤í¬ í…Œë§ˆ ë©”ëª¨ì¥</title>
    <link rel="icon" href="notepad.png" type="image/png">
    <!-- MathJax for ìˆ˜ì‹ ë¯¸ë¦¬ë³´ê¸° -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --bg-color: #222222;
            --text-color: #E0D268;
            --accent-color: #E0D268;
            --border-color: #E0D268;
            --toolbar-bg: #333333;
            --font-family: 'Arial', sans-serif;
        }
        [data-theme="midnight"] {
            --bg-color: #121212;
            --text-color: #A8DADC;
            --accent-color: #004D61;
            --border-color: #004D61;
            --toolbar-bg: #1A1A1A;
        }
        [data-theme="forest"] {
            --bg-color: #1A1A1A;
            --text-color: #E4E4E4;
            --accent-color: #3E5641;
            --border-color: #3E5641;
            --toolbar-bg: #222222;
        }
        [data-theme="twilight"] {
            --bg-color: #2C2C2C;
            --text-color: #B39CD0;
            --accent-color: #FFC1CC;
            --border-color: #FFC1CC;
            --toolbar-bg: #333333;
        }
        [data-theme="warm"] {
            --bg-color: #1C1C1C;
            --text-color: #F5E8D8;
            --accent-color: #DAA520;
            --border-color: #DAA520;
            --toolbar-bg: #2A2A2A;
        }
        [data-theme="emerald"] {
            --bg-color: #222222;
            --text-color: #A9DFBF;
            --accent-color: #4A5E3D;
            --border-color: #4A5E3D;
            --toolbar-bg: #2E2E2E;
        }
        body {
            font-family: var(--font-family);
            margin: 40px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        h2 {
            color: var(--text-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        textarea {
            width: 100%;
            height: 400px;
            font-size: 16px;
            padding: 15px;
            box-sizing: border-box;
            background-color: var(--toolbar-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            line-height: 1.5;
            font-family: inherit;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            box-shadow: 0 0 5px var(--accent-color);
        }
        button {
            margin: 5px;
            padding: 8px 15px;
            font-size: 14px;
            background-color: var(--toolbar-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 15px;
        }
        .toolbar {
            background-color: var(--toolbar-bg);
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .toolbar button {
            margin: 2px;
            padding: 5px 10px;
        }
        .color-picker {
            height: 30px;
            width: 30px;
            padding: 0;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background-color: transparent;
            cursor: pointer;
        }
        .font-size, .font-family {
            background-color: var(--toolbar-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            padding: 5px;
        }
        .separator {
            width: 1px;
            height: 30px;
            background-color: var(--border-color);
            margin: 0 5px;
        }
        .active {
            background-color: var(--accent-color);
            color: var(--bg-color);
        }
        .theme-selector {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .theme-btn {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: var(--toolbar-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }
        .fullscreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-color: var(--bg-color);
        }
        .fullscreen textarea {
            height: calc(100vh - 150px);
        }
        .fullscreen-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 10000;
            display: none;
        }
        .fullscreen .fullscreen-controls {
            display: block;
        }
        .search-container {
            display: flex;
            margin-top: 10px;
            gap: 5px;
            margin-bottom: 10px;
        }
        .search-container input {
            flex-grow: 1;
            padding: 8px;
            border-radius: 5px;
            border: 2px solid var(--border-color);
            background-color: var(--toolbar-bg);
            color: var(--text-color);
        }
        .note-list {
            display: none;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border-radius: 5px;
            background-color: var(--toolbar-bg);
            border: 2px solid var(--border-color);
        }
        .note-item {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 3px;
            cursor: pointer;
            background-color: rgba(255,255,255,0.1);
        }
        .note-item:hover {
            background-color: var(--accent-color);
            color: var(--bg-color);
        }
        /* ë¯¸ë¦¬ë³´ê¸° ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .preview-container { display: none; }
        .split-view { display: flex; gap: 15px; }
        .split-view textarea { width: 50%; height: 400px; }
        .split-view .preview-pane {
            width: 50%; height: 400px; overflow: auto;
            padding: 15px; border-radius: 5px;
            background-color: var(--toolbar-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
        }
        .img-toggle-btn {
            display: inline-block;
            background: #444;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 2px 8px;
            cursor: pointer;
            margin: 2px 0;
            font-size: 0.95em;
        }
        .img-preview { display: none; margin: 5px 0; }
    </style>
</head>
<body>
    <div id="main-container">
        <h2><img src="notepad.png" alt="ì•„ì´ì½˜" style="height:1.2em;vertical-align:middle;margin-right:8px;">ë‹¤í¬ í…Œë§ˆ ë©”ëª¨ì¥</h2>
        <div class="theme-selector">
            <button class="theme-btn" onclick="changeTheme('default')">ê¸°ë³¸ í…Œë§ˆ</button>
            <button class="theme-btn" onclick="changeTheme('midnight')">ë¯¸ë“œë‚˜ì´íŠ¸ ë¸”ë£¨</button>
            <button class="theme-btn" onclick="changeTheme('forest')">ë”¥ í¬ë ˆìŠ¤íŠ¸</button>
            <button class="theme-btn" onclick="changeTheme('twilight')">íŠ¸ì™€ì¼ë¼ì‡</button>
            <button class="theme-btn" onclick="changeTheme('warm')">ì›œ í†¤</button>
            <button class="theme-btn" onclick="changeTheme('emerald')">ì—ë©”ë„ë“œ</button>
        </div>
        <div class="toolbar">
            <button id="bold" onclick="formatText('bold')" title="êµµê²Œ"><b>B</b></button>
            <button id="italic" onclick="formatText('italic')" title="ê¸°ìš¸ì„"><i>I</i></button>
            <button id="underline" onclick="formatText('underline')" title="ë°‘ì¤„"><u>U</u></button>
            <button id="strikethrough" onclick="formatText('strikethrough')" title="ì·¨ì†Œì„ "><s>S</s></button>
            <div class="separator"></div>
            <button onclick="formatText('heading1')" title="ì œëª© 1">H1</button>
            <button onclick="formatText('heading2')" title="ì œëª© 2">H2</button>
            <button onclick="formatText('heading3')" title="ì œëª© 3">H3</button>
            <div class="separator"></div>
            <button onclick="formatText('list')" title="ëª©ë¡">-  ëª©ë¡</button>
            <button onclick="formatText('numberedList')" title="ë²ˆí˜¸ ëª©ë¡">1. ë²ˆí˜¸</button>
            <div class="separator"></div>
            <select class="font-size" onchange="changeFont(this.value)" title="ê¸€ê¼´ í¬ê¸°">
                <option value="">ê¸€ê¼´ í¬ê¸°</option>
                <option value="small">ì‘ê²Œ</option>
                <option value="medium">ë³´í†µ</option>
                <option value="large">í¬ê²Œ</option>
                <option value="x-large">ë§¤ìš° í¬ê²Œ</option>
            </select>
            <select class="font-family" onchange="changeFontFamily(this.value)" title="ê¸€ê¼´">
                <option value="">ê¸€ê¼´</option>
                <option value="Arial, sans-serif">Arial</option>
                <option value="'Times New Roman', serif">Times New Roman</option>
                <option value="'Courier New', monospace">Courier New</option>
                <option value="Georgia, serif">Georgia</option>
                <option value="Verdana, sans-serif">Verdana</option>
                <option value="'Nanum Gothic', sans-serif">ë‚˜ëˆ” ê³ ë”•</option>
                <option value="'Malgun Gothic', sans-serif">ë§‘ì€ ê³ ë”•</option>
            </select>
            <div class="separator"></div>
            <input type="color" value="#E0D268" class="color-picker" onchange="changeColor(this.value)" title="ê¸€ì ìƒ‰ìƒ">
            <button onclick="resetColor()" title="ê¸°ë³¸ ìƒ‰ìƒìœ¼ë¡œ ë³µì›">ê¸°ë³¸ìƒ‰</button>
            <div class="separator"></div>
            <button onclick="insertDateTime()" title="ë‚ ì§œ/ì‹œê°„ ì‚½ì…">ë‚ ì§œ/ì‹œê°„</button>
            <button onclick="toggleFullscreen()" title="ì „ì²´ í™”ë©´ ëª¨ë“œ">ì „ì²´í™”ë©´</button>
            <button onclick="togglePreview()" title="ë¯¸ë¦¬ë³´ê¸°">ë¯¸ë¦¬ë³´ê¸°</button>
        </div>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="ë©”ëª¨ ë‚´ìš© ê²€ìƒ‰...">
            <button onclick="searchText()">ê²€ìƒ‰</button>
            <button onclick="clearSearch()">ì§€ìš°ê¸°</button>
        </div>
        <div id="note-list" class="note-list"></div>
        <!-- ê¸°ë³¸ í¸ì§‘ í™”ë©´ -->
        <div id="editContainer">
            <textarea id="notepad" placeholder="ì—¬ê¸°ì— ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." oninput="autoSave(); updateWordCount();"></textarea>
        </div>
        <!-- ë¯¸ë¦¬ë³´ê¸° í™”ë©´ -->
        <div id="previewContainer" class="preview-container">
            <div class="split-view">
                <textarea id="splitNotepad" placeholder="ì—¬ê¸°ì— ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." oninput="updatePreview(); autoSave(); updateWordCount();"></textarea>
                <div id="previewPane" class="preview-pane"></div>
            </div>
        </div>
        <div class="fullscreen-controls">
            <button onclick="toggleFullscreen()">ì „ì²´í™”ë©´ ì¢…ë£Œ</button>
        </div>
        <div class="status-bar">
            <span id="wordCount">ê¸€ì ìˆ˜: 0 | ë‹¨ì–´ ìˆ˜: 0 | ì¤„ ìˆ˜: 0</span>
            <span id="lastSaved">ë§ˆì§€ë§‰ ì €ì¥: -</span>
        </div>
        <div class="button-container">
            <button onclick="saveNote()">ì €ì¥</button>
            <button onclick="loadNote()">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button onclick="clearNote()">ì§€ìš°ê¸°</button>
            <button onclick="downloadNote()">ë‹¤ìš´ë¡œë“œ</button>
            <button onclick="copyToClipboard()">í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
            <button onclick="createNewNote()">ìƒˆ ë©”ëª¨</button>
            <button onclick="toggleNoteList()">ë©”ëª¨ ëª©ë¡</button>
        </div>
    </div>
    <script>
        // ... ê¸°ì¡´ ë³€ìˆ˜ ë° í•¨ìˆ˜ ìƒëµ ...
        let currentNoteId = 'default';
        let autoSaveTimer;
        let notes = {};
        let isFullscreen = false;

        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
        })();

        function changeTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }
        function autoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(function() { saveNote(true); }, 3000);
        }
        function saveNote(isAuto = false) {
            const content = isPreviewMode() ? document.getElementById('splitNotepad').value : document.getElementById('notepad').value;
            notes[currentNoteId] = { content: content, lastModified: new Date().toLocaleString() };
            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.setItem('noteIds', JSON.stringify(Object.keys(notes)));
            localStorage.setItem('currentNoteId', currentNoteId);
            updateLastSaved(isAuto);
        }
        function updateLastSaved(isAuto) {
            const now = new Date().toLocaleString();
            document.getElementById('lastSaved').textContent = 'ë§ˆì§€ë§‰ ì €ì¥: ' + now + (isAuto ? ' (ìë™)' : '');
        }
        function loadNote() {
            const savedNotes = localStorage.getItem('notes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                const savedCurrentNoteId = localStorage.getItem('currentNoteId');
                if (savedCurrentNoteId) currentNoteId = savedCurrentNoteId;
                if (notes[currentNoteId]) {
                    const content = notes[currentNoteId].content;
                    document.getElementById('notepad').value = content;
                    document.getElementById('splitNotepad').value = content;
                    if (isPreviewMode()) updatePreview();
                    updateWordCount();
                    alert('ë©”ëª¨ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                } else alert('ì €ì¥ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.');
            } else alert('ì €ì¥ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.');
            updateNoteList();
        }
        function clearNote() {
            if(confirm('ì •ë§ë¡œ ë©”ëª¨ë¥¼ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                if (isPreviewMode()) {
                    document.getElementById('splitNotepad').value = '';
                    updatePreview();
                } else document.getElementById('notepad').value = '';
                updateWordCount();
            }
        }
        function downloadNote() {
            const text = isPreviewMode() ? document.getElementById('splitNotepad').value : document.getElementById('notepad').value;
            if (!text) return alert('ë‹¤ìš´ë¡œë“œí•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            const filename = prompt('íŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', 'memo.txt');
            if (!filename) return;
            a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url);
        }
        function copyToClipboard() {
            const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
            textarea.select();
            document.execCommand('copy');
            alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        function formatText(format) {
            const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
            const start = textarea.selectionStart, end = textarea.selectionEnd, selectedText = textarea.value.substring(start, end);
            let formattedText = '';
            switch(format) {
                case 'bold': formattedText = `**${selectedText}**`; break;
                case 'italic': formattedText = `*${selectedText}*`; break;
                case 'underline': formattedText = `_${selectedText}_`; break;
                case 'strikethrough': formattedText = `~~${selectedText}~~`; break;
                case 'heading1': formattedText = `\n# ${selectedText}\n`; break;
                case 'heading2': formattedText = `\n## ${selectedText}\n`; break;
                case 'heading3': formattedText = `\n### ${selectedText}\n`; break;
                case 'list': formattedText = selectedText.split('\n').map(line => `-  ${line}`).join('\n'); break;
                case 'numberedList': formattedText = selectedText.split('\n').map((line, i) => `${i+1}. ${line}`).join('\n'); break;
            }
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            textarea.selectionStart = start;
            textarea.selectionEnd = start + formattedText.length;
            toggleButtonState(format);
            if (isPreviewMode()) updatePreview();
            autoSave();
            updateWordCount();
        }
        function toggleButtonState(format) {
            const button = document.getElementById(format);
            if (button) {
                button.classList.toggle('active');
                setTimeout(() => { button.classList.remove('active'); }, 300);
            }
        }
        function changeFont(size) {
            const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
            const start = textarea.selectionStart, end = textarea.selectionEnd, selectedText = textarea.value.substring(start, end);
            if (!selectedText) return alert('ê¸€ê¼´ í¬ê¸°ë¥¼ ë³€ê²½í•  í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
            let sizeTag = '';
            switch(size) {
                case 'small': sizeTag = '<small>'; break;
                case 'medium': sizeTag = '<medium>'; break;
                case 'large': sizeTag = '<large>'; break;
                case 'x-large': sizeTag = '<x-large>'; break;
                default: return;
            }
            const formattedText = `${sizeTag}${selectedText}</${size}>`;
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            if (isPreviewMode()) updatePreview();
            autoSave();
            updateWordCount();
        }
        function changeFontFamily(fontFamily) {
            if (fontFamily) {
                document.documentElement.style.setProperty('--font-family', fontFamily);
                localStorage.setItem('fontFamily', fontFamily);
            }
        }
        function changeColor(color) {
            const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
            const start = textarea.selectionStart, end = textarea.selectionEnd, selectedText = textarea.value.substring(start, end);
            if (!selectedText) return alert('ìƒ‰ìƒì„ ë³€ê²½í•  í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
            const formattedText = `<color=${color}>${selectedText}</color>`;
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            if (isPreviewMode()) updatePreview();
            autoSave();
            updateWordCount();
        }
        function resetColor() {
            const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
            const start = textarea.selectionStart, end = textarea.selectionEnd, selectedText = textarea.value.substring(start, end);
            if (!selectedText) return alert('ìƒ‰ìƒì„ ì´ˆê¸°í™”í•  í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
            const regex = /<color=[^>]+>(.+?)<\/color>/g;
            const formattedText = selectedText.replace(regex, '$1');
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            if (isPreviewMode()) updatePreview();
            autoSave();
            updateWordCount();
        }
        function insertDateTime() {
            const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
            const cursorPos = textarea.selectionStart;
            const now = new Date().toLocaleString();
            const dateTimeText = `[${now}] `;
            textarea.value = textarea.value.substring(0, cursorPos) + dateTimeText + textarea.value.substring(cursorPos);
            textarea.focus();
            textarea.selectionStart = cursorPos + dateTimeText.length;
            textarea.selectionEnd = cursorPos + dateTimeText.length;
            if (isPreviewMode()) updatePreview();
            autoSave();
            updateWordCount();
        }
        function toggleFullscreen() {
            const container = document.getElementById('main-container');
            if (isFullscreen) {
                container.classList.remove('fullscreen');
                document.body.style.overflow = 'auto';
                isFullscreen = false;
            } else {
                container.classList.add('fullscreen');
                document.body.style.overflow = 'hidden';
                isFullscreen = true;
                const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
                textarea.focus();
            }
        }
        function togglePreview() {
            const editContainer = document.getElementById('editContainer');
            const previewContainer = document.getElementById('previewContainer');
            if (editContainer.style.display === 'none') {
                editContainer.style.display = 'block';
                previewContainer.style.display = 'none';
                document.getElementById('notepad').value = document.getElementById('splitNotepad').value;
            } else {
                editContainer.style.display = 'none';
                previewContainer.style.display = 'block';
                document.getElementById('splitNotepad').value = document.getElementById('notepad').value;
                updatePreview();
            }
        }
        function isPreviewMode() {
            return document.getElementById('editContainer').style.display === 'none';
        }
        // --- ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (ìˆ˜ì‹/ê·¸ë¦¼ ì ‘ê¸° ë°˜ì˜) ---
        function updatePreview() {
            const markdown = document.getElementById('splitNotepad').value;
            const previewPane = document.getElementById('previewPane');
            // 1. ì´ë¯¸ì§€ íƒœê·¸ë¥¼ ì ‘ê¸° ë²„íŠ¼ìœ¼ë¡œ ë³€í™˜
            let html = markdown.replace(/<img\s+src="([^"]+)"\s+alt="([^"]*)"\s*>/g, function(match, src, alt) {
                const imgId = 'img_' + Math.random().toString(36).substr(2, 9);
                return `
                    <button class="img-toggle-btn" onclick="toggleImgPreview('${imgId}')">ğŸ–¼ï¸ ê·¸ë¦¼(í´ë¦­)</button>
                    <div id="${imgId}" class="img-preview">
                        <img src="${src}" alt="${alt}" style="max-width:100%;"><br>
                        <button class="img-toggle-btn" onclick="toggleImgPreview('${imgId}')">ì ‘ê¸°</button>
                    </div>
                `;
            });
            // 2. ìˆ˜ì‹ì€ div.mathë¡œ ê°ì‹¸ê³ , MathJaxê°€ ë Œë”ë§í•˜ë„ë¡
            html = html.replace(/\$\$(.*?)\$\$/gs, function(match, math) {
                return `<div class="math">$$${math}$$</div>`;
            });
            // 3. ë§ˆí¬ë‹¤ìš´ ë“± ê¸°íƒ€ ë³€í™˜ (ê°„ë‹¨ ë²„ì „)
            html = html
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/_(.*?)_/g, '<u>$1</u>')
                .replace(/~~(.*?)~~/g, '<s>$1</s>')
                .replace(/^-  (.*$)/gm, '<li>$1</li>')
                .replace(/^\d+\. (.*$)/gm, '<li>$1</li>')
                .replace(/<color=([^>]+)>(.*?)<\/color>/g, '<span style="color:$1">$2</span>')
                .replace(/\n/g, '<br>');
            previewPane.innerHTML = html;
            if (typeof MathJax !== 'undefined') {
                MathJax.typesetPromise([previewPane]).catch(function (err) {
                    console.log('MathJax ì˜¤ë¥˜:', err);
                });
            }
        }
        // ê·¸ë¦¼ ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€ í•¨ìˆ˜ (ì „ì—­)
        window.toggleImgPreview = function(id) {
            const el = document.getElementById(id);
            if (!el) return;
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        };
        function updateWordCount() {
            const text = isPreviewMode() ? document.getElementById('splitNotepad').value : document.getElementById('notepad').value;
            const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const lineCount = text === '' ? 0 : text.split('\n').length;
            document.getElementById('wordCount').textContent =
                `ê¸€ì ìˆ˜: ${text.length} | ë‹¨ì–´ ìˆ˜: ${wordCount} | ì¤„ ìˆ˜: ${lineCount}`;
        }
        function createNewNote() {
            const noteTitle = prompt('ìƒˆ ë©”ëª¨ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (!noteTitle) return;
            const noteId = 'note_' + Date.now();
            notes[noteId] = { title: noteTitle, content: '', lastModified: new Date().toLocaleString() };
            currentNoteId = noteId;
            document.getElementById('notepad').value = '';
            document.getElementById('splitNotepad').value = '';
            if (isPreviewMode()) updatePreview();
            updateWordCount();
            saveNote();
            updateNoteList();
        }
        function toggleNoteList() {
            const noteList = document.getElementById('note-list');
            if (noteList.style.display === 'block') noteList.style.display = 'none';
            else { noteList.style.display = 'block'; updateNoteList(); }
        }
        function updateNoteList() {
            const noteList = document.getElementById('note-list');
            noteList.innerHTML = '';
            for (const noteId in notes) {
                const note = notes[noteId];
                const noteItem = document.createElement('div');
                noteItem.className = 'note-item';
                noteItem.textContent = note.title || `ë©”ëª¨ ${noteId.substring(5)}`;
                noteItem.onclick = function() { loadSpecificNote(noteId); };
                if (noteId === currentNoteId) noteItem.style.fontWeight = 'bold';
                noteList.appendChild(noteItem);
            }
        }
        function loadSpecificNote(noteId) {
            if (notes[noteId]) {
                currentNoteId = noteId;
                const content = notes[noteId].content;
                document.getElementById('notepad').value = content;
                document.getElementById('splitNotepad').value = content;
                if (isPreviewMode()) updatePreview();
                updateWordCount();
                updateNoteList();
            }
        }
        function searchText() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) return alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            const textarea = isPreviewMode() ? document.getElementById('splitNotepad') : document.getElementById('notepad');
            const text = textarea.value;
            const index = text.indexOf(searchTerm);
            if (index !== -1) {
                textarea.focus();
                textarea.setSelectionRange(index, index + searchTerm.length);
            } else alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
        }
        function clearSearch() {
            document.getElementById('searchInput').value = '';
        }
        window.onload = function() {
            var theme = localStorage.getItem('theme');
            if (theme !== null) changeTheme(theme);
            var fontFamily = localStorage.getItem('fontFamily');
            if (fontFamily !== null) document.documentElement.style.setProperty('--font-family', fontFamily);
            loadNote();
            updateWordCount();
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey) {
                    switch(e.key) {
                        case 'b': e.preventDefault(); formatText('bold'); break;
                        case 'i': e.preventDefault(); formatText('italic'); break;
                        case 'u': e.preventDefault(); formatText('underline'); break;
                        case 's': e.preventDefault(); saveNote(); break;
                        case 'f': e.preventDefault(); document.getElementById('searchInput').focus(); break;
                        case 'p': e.preventDefault(); togglePreview(); break;
                    }
                } else if (e.key === 'F11') {
                    e.preventDefault(); toggleFullscreen();
                } else if (e.key === 'Escape' && isFullscreen) {
                    e.preventDefault(); toggleFullscreen();
                }
            });
        };
    </script>
</body>
</html>
