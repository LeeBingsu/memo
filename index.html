<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>다크 테마 메모장</title>
    <style>
        /* 기존 스타일 유지 */
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            transition: all 0.3s ease;
        }
        h2 {
            padding-bottom: 10px;
            transition: all 0.3s ease;
        }
        textarea { 
            width: 100%; 
            height: 400px; 
            font-size: 16px; 
            padding: 15px; 
            box-sizing: border-box;
            border-radius: 5px;
            line-height: 1.5;
            transition: all 0.3s ease;
        }
        textarea:focus {
            outline: none;
        }
        button { 
            margin: 5px; 
            padding: 8px 15px; 
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover {
            filter: brightness(1.2);
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 15px;
        }
        .toolbar {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            transition: all 0.3s ease;
        }
        .toolbar button {
            margin: 2px;
            padding: 5px 10px;
        }
        .color-picker {
            height: 30px;
            width: 30px;
            padding: 0;
            border-radius: 5px;
            background-color: transparent;
            cursor: pointer;
        }
        .font-size {
            border-radius: 5px;
            padding: 5px;
            transition: all 0.3s ease;
        }
        .separator {
            width: 1px;
            height: 30px;
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        .active {
            filter: brightness(1.2);
        }
        .theme-selector {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .theme-btn {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        /* 테마 스타일 유지 */
        /* 기본 테마 (뮤티드 옐로우) */
        body.theme-default { 
            background: #222222; 
            color: #E0D268;
        }
        body.theme-default h2 {
            color: #E0D268;
            border-bottom: 2px solid #E0D268;
        }
        body.theme-default textarea { 
            background-color: #333333; 
            color: #E0D268; 
            border: 2px solid #E0D268;
        }
        body.theme-default textarea:focus {
            box-shadow: 0 0 5px #E0D268;
        }
        body.theme-default button { 
            background-color: #333333; 
            color: #E0D268; 
            border: 2px solid #E0D268; 
        }
        body.theme-default button:hover {
            background-color: #E0D268;
            color: #222222;
        }
        body.theme-default .toolbar {
            background-color: #333333;
            border: 2px solid #E0D268;
        }
        body.theme-default .color-picker {
            border: 2px solid #E0D268;
        }
        body.theme-default .font-size {
            background-color: #333333;
            color: #E0D268;
            border: 2px solid #E0D268;
        }
        body.theme-default .separator {
            background-color: #E0D268;
        }
        body.theme-default .active {
            background-color: #E0D268;
            color: #222222;
        }
        
        /* 다른 테마 스타일 유지 */
        
        /* 새로운 스타일 추가 */
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .preview-container {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .split-view {
            display: flex;
            gap: 15px;
        }
        
        .split-view textarea {
            width: 50%;
            height: 400px;
        }
        
        .split-view .preview-pane {
            width: 50%;
            height: 400px;
            overflow: auto;
            padding: 15px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .search-container {
            display: flex;
            margin-top: 10px;
            gap: 5px;
        }
        
        .search-container input {
            flex-grow: 1;
            padding: 8px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .note-list {
            display: none;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .note-item {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .note-item:hover {
            filter: brightness(1.1);
        }
        
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        
        /* 테마별 새로운 요소 스타일 */
        body.theme-default .status-bar {
            background-color: #333333;
            color: #E0D268;
            border: 1px solid #E0D268;
        }
        
        body.theme-default .preview-container {
            background-color: #333333;
            border: 2px solid #E0D268;
        }
        
        body.theme-default .split-view .preview-pane {
            background-color: #333333;
            border: 2px solid #E0D268;
            color: #E0D268;
        }
        
        body.theme-default .search-container input {
            background-color: #333333;
            color: #E0D268;
            border: 2px solid #E0D268;
        }
        
        body.theme-default .note-list {
            background-color: #333333;
            border: 2px solid #E0D268;
        }
        
        body.theme-default .note-item {
            background-color: #444444;
            color: #E0D268;
        }
        
        /* 다른 테마에 대한 새로운 요소 스타일도 추가 */
    </style>
</head>
<body class="theme-default">
    <h2>다크 테마 메모장</h2>
    
    <div class="theme-selector">
        <button class="theme-btn" onclick="changeTheme('default')">기본 테마</button>
        <button class="theme-btn" onclick="changeTheme('midnight')">미드나이트 블루</button>
        <button class="theme-btn" onclick="changeTheme('forest')">딥 포레스트</button>
        <button class="theme-btn" onclick="changeTheme('twilight')">트와일라잇</button>
        <button class="theme-btn" onclick="changeTheme('warm')">웜 톤</button>
        <button class="theme-btn" onclick="changeTheme('emerald')">에메랄드</button>
    </div>
    
    <div class="toolbar">
        <button id="bold" onclick="formatText('bold')" title="굵게"><b>B</b></button>
        <button id="italic" onclick="formatText('italic')" title="기울임"><i>I</i></button>
        <button id="underline" onclick="formatText('underline')" title="밑줄"><u>U</u></button>
        <button id="strikethrough" onclick="formatText('strikethrough')" title="취소선"><s>S</s></button>
        
        <div class="separator"></div>
        
        <button onclick="formatText('heading1')" title="제목 1">H1</button>
        <button onclick="formatText('heading2')" title="제목 2">H2</button>
        <button onclick="formatText('heading3')" title="제목 3">H3</button>
        
        <div class="separator"></div>
        
        <button onclick="formatText('list')" title="목록">-  목록</button>
        <button onclick="formatText('numberedList')" title="번호 목록">1. 번호</button>
        
        <div class="separator"></div>
        
        <select class="font-size" onchange="changeFont(this.value)" title="글꼴 크기">
            <option value="">글꼴 크기</option>
            <option value="small">작게</option>
            <option value="medium">보통</option>
            <option value="large">크게</option>
            <option value="x-large">매우 크게</option>
        </select>
        
        <div class="separator"></div>
        
        <input type="color" value="#E0D268" class="color-picker" onchange="changeColor(this.value)" title="글자 색상">
        <button onclick="resetColor()" title="기본 색상으로 복원">기본색</button>
        
        <div class="separator"></div>
        
        <!-- 새로운 기능 버튼 추가 -->
        <button onclick="insertDateTime()" title="날짜/시간 삽입">날짜/시간</button>
        <button onclick="togglePreview()" title="마크다운 미리보기">미리보기</button>
        <button onclick="toggleFullscreen()" title="전체 화면 모드">전체화면</button>
        <button onclick="toggleNoteList()" title="메모 목록">메모 목록</button>
    </div>
    
    <!-- 검색 기능 추가 -->
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="메모 내용 검색...">
        <button onclick="searchText()">검색</button>
        <button onclick="clearSearch()">지우기</button>
    </div>
    
    <!-- 메모 목록 컨테이너 -->
    <div id="noteList" class="note-list"></div>
    
    <!-- 기본 편집 화면 -->
    <div id="editContainer">
        <textarea id="notepad" placeholder="여기에 메모를 입력하세요..." oninput="autoSave(); updateWordCount();"></textarea>
    </div>
    
    <!-- 미리보기 화면 -->
    <div id="previewContainer" class="preview-container">
        <div class="split-view">
            <textarea id="splitNotepad" placeholder="여기에 메모를 입력하세요..." oninput="updatePreview(); autoSave(); updateWordCount();"></textarea>
            <div id="previewPane" class="preview-pane"></div>
        </div>
    </div>
    
    <!-- 상태 표시줄 추가 -->
    <div class="status-bar">
        <span id="wordCount">글자 수: 0 | 줄 수: 0</span>
        <span id="lastSaved">마지막 저장: -</span>
    </div>
    
    <div class="button-container">
        <button onclick="saveNote()">저장</button>
        <button onclick="loadNote()">불러오기</button>
        <button onclick="clearNote()">지우기</button>
        <button onclick="downloadNote()">다운로드</button>
        <button onclick="copyToClipboard()">클립보드에 복사</button>
        <button onclick="createNewNote()">새 메모</button>
        <button onclick="exportAsHTML()">HTML 내보내기</button>
        <button onclick="exportAsMarkdown()">Markdown 내보내기</button>
    </div>
    
    <script>
        // 전역 변수
        let currentNoteId = 'default';
        let autoSaveTimer;
        let notes = {};
        let isFullscreen = false;
        
        // 테마 변경 함수
        function changeTheme(theme) {
            document.body.className = '';
            document.body.classList.add('theme-' + theme);
            localStorage.setItem('theme', theme);
        }
        
        // 자동 저장 기능
        function autoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(function() {
                saveNote(true); // true는 자동 저장임을 나타냄
            }, 3000); // 3초 후 자동 저장
        }
        
        // 저장 함수 확장
        function saveNote(isAuto = false) {
            const content = isPreviewMode() ? 
                document.getElementById('splitNotepad').value : 
                document.getElementById('notepad').value;
            
            // 현재 메모 저장
            notes[currentNoteId] = {
                content: content,
                lastModified: new Date().toLocaleString()
            };
            
            // 모든 메모 저장
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // 메모 ID 목록 저장
            localStorage.setItem('noteIds', JSON.stringify(Object.keys(notes)));
            
            // 현재 메모 ID 저장
            localStorage.setItem('currentNoteId', currentNoteId);
            
            // 상태 표시줄 업데이트
            updateLastSaved(isAuto);
        }
        
        // 마지막 저장 시간 업데이트
        function updateLastSaved(isAuto) {
            const now = new Date().toLocaleString();
            document.getElementById('lastSaved').textContent = 
                '마지막 저장: ' + now + (isAuto ? ' (자동)' : '');
        }
        
        // 불러오기 함수 확장
        function loadNote() {
            // 모든 메모 불러오기
            const savedNotes = localStorage.getItem('notes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                
                // 현재 메모 ID 불러오기
                const savedCurrentNoteId = localStorage.getItem('currentNoteId');
                if (savedCurrentNoteId) {
                    currentNoteId = savedCurrentNoteId;
                }
                
                // 현재 메모 내용 표시
                if (notes[currentNoteId]) {
                    const content = notes[currentNoteId].content;
                    document.getElementById('notepad').value = content;
                    document.getElementById('splitNotepad').value = content;
                    
                    if (isPreviewMode()) {
                        updatePreview();
                    }
                    
                    updateWordCount();
                    alert('메모를 불러왔습니다!');
                } else {
                    alert('저장된 메모가 없습니다.');
                }
            } else {
                alert('저장된 메모가 없습니다.');
            }
            
            // 메모 목록 업데이트
            updateNoteList();
        }
        
        // 메모 지우기
        function clearNote() {
            if(confirm('정말로 메모를 지우시겠습니까?')) {
                if (isPreviewMode()) {
                    document.getElementById('splitNotepad').value = '';
                    updatePreview();
                } else {
                    document.getElementById('notepad').value = '';
                }
                updateWordCount();
            }
        }
        
        // 다운로드 함수
        function downloadNote() {
            const text = isPreviewMode() ? 
                document.getElementById('splitNotepad').value : 
                document.getElementById('notepad').value;
                
            if (!text) {
                alert('다운로드할 내용이 없습니다.');
                return;
            }
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            const filename = prompt('파일 이름을 입력하세요:', 'memo.txt');
            if (!filename) return; // 취소 시 중단
            
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // 클립보드에 복사
        function copyToClipboard() {
            const textarea = isPreviewMode() ? 
                document.getElementById('splitNotepad') : 
                document.getElementById('notepad');
                
            textarea.select();
            document.execCommand('copy');
            alert('클립보드에 복사되었습니다!');
        }
        
        // 텍스트 서식 지정
        function formatText(format) {
            const textarea = isPreviewMode() ? 
                document.getElementById('splitNotepad') : 
                document.getElementById('notepad');
                
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            let formattedText = '';
            
            switch(format) {
                case 'bold':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'italic':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'underline':
                    formattedText = `_${selectedText}_`;
                    break;
                case 'strikethrough':
                    formattedText = `~~${selectedText}~~`;
                    break;
                case 'heading1':
                    formattedText = `\n# ${selectedText}\n`;
                    break;
                case 'heading2':
                    formattedText = `\n## ${selectedText}\n`;
                    break;
                case 'heading3':
                    formattedText = `\n### ${selectedText}\n`;
                    break;
                case 'list':
                    formattedText = selectedText.split('\n').map(line => `-  ${line}`).join('\n');
                    break;
                case 'numberedList':
                    formattedText = selectedText.split('\n').map((line, index) => `${index + 1}. ${line}`).join('\n');
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            textarea.selectionStart = start;
            textarea.selectionEnd = start + formattedText.length;
            
            // 버튼 활성화 상태 토글
            toggleButtonState(format);
            
            // 미리보기 모드인 경우 미리보기 업데이트
            if (isPreviewMode()) {
                updatePreview();
            }
            
            // 자동 저장 및 단어 수 업데이트
            autoSave();
            updateWordCount();
        }
        
        // 버튼 상태 토글
        function toggleButtonState(format) {
            const button = document.getElementById(format);
            if (button) {
                button.classList.toggle('active');
                setTimeout(() => {
                    button.classList.remove('active');
                }, 300);
            }
        }
        
        // 글꼴 크기 변경
        function changeFont(size) {
            const textarea = isPreviewMode() ? 
                document.getElementById('splitNotepad') : 
                document.getElementById('notepad');
                
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('글꼴 크기를 변경할 텍스트를 먼저 선택하세요.');
                return;
            }
            
            let sizeTag = '';
            switch(size) {
                case 'small':
                    sizeTag = '<small>';
                    break;
                case 'medium':
                    sizeTag = '<medium>';
                    break;
                case 'large':
                    sizeTag = '<large>';
                    break;
                case 'x-large':
                    sizeTag = '<x-large>';
                    break;
                default:
                    return;
            }
            
            const formattedText = `${sizeTag}${selectedText}</${size}>`;
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            
            // 미리보기 모드인 경우 미리보기 업데이트
            if (isPreviewMode()) {
                updatePreview();
            }
            
            // 자동 저장 및 단어 수 업데이트
            autoSave();
            updateWordCount();
        }
        
        // 색상 변경
        function changeColor(color) {
            const textarea = isPreviewMode() ? 
                document.getElementById('splitNotepad') : 
                document.getElementById('notepad');
                
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('색상을 변경할 텍스트를 먼저 선택하세요.');
                return;
            }
            
            const formattedText = `<color=${color}>${selectedText}</color>`;
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            
            // 미리보기 모드인 경우 미리보기 업데이트
            if (isPreviewMode()) {
                updatePreview();
            }
            
            // 자동 저장 및 단어 수 업데이트
            autoSave();
            updateWordCount();
        }
        
        // 색상 초기화
        function resetColor() {
            const textarea = isPreviewMode() ? 
                document.getElementById('splitNotepad') : 
                document.getElementById('notepad');
                
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (!selectedText) {
                alert('색상을 초기화할 텍스트를 먼저 선택하세요.');
                return;
            }
            
            // 색상 태그 제거
            const regex = /<color=[^>]+>(.+?)<\/color>/g;
            const formattedText = selectedText.replace(regex, '$1');
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            textarea.focus();
            
            // 미리보기 모드인 경우 미리보기 업데이트
            if (isPreviewMode()) {
                updatePreview();
            }
            
            // 자동 저장 및 단어 수 업데이트
            autoSave();
            updateWordCount();
        }
        
        // 날짜/시간 삽입
        function insertDateTime() {
            const textarea = isPreviewMode() ? 
                document.getElementById('splitNotepad') : 
                document.getElementById('notepad');
                
            const cursorPos = textarea.selectionStart;
            const now = new Date().toLocaleString();
            const dateTimeText = `[${now}] `;
            
            textarea.value = 
                textarea.value.substring(0, cursorPos) + 
                dateTimeText + 
                textarea.value.substring(cursorPos);
                
            textarea.focus();
            textarea.selectionStart = cursorPos + dateTimeText.length;
            textarea.selectionEnd = cursorPos + dateTimeText.length;
            
            // 미리보기 모드인 경우 미리보기 업데이트
            if (isPreviewMode()) {
                updatePreview();
            }
            
            // 자동 저장 및 단어 수 업데이트
            autoSave();
            updateWordCount();
        }
        
        // 미리보기 모드 토글
        function togglePreview() {
            const editContainer = document.getElementById('editContainer');
            const previewContainer = document.getElementById('previewContainer');
            
            if (editContainer.style.display === 'none') {
                // 편집 모드로 전환
                editContainer.style.display = 'block';
                previewContainer.style.display = 'none';
                document.getElementById('notepad').value = document.getElementById('splitNotepad').value;
            } else {
                // 미리보기 모드로 전환
                editContainer.style.display = 'none';
                previewContainer.style.display = 'block';
                document.getElementById('splitNotepad').value = document.getElementById('notepad').value;
                updatePreview();
            }
        }
        
        // 미리보기 모드인지 확인
        function isPreviewMode() {
            return document.getElementById('editContainer').style.display === 'none';
        }
        
        // 미리보기 업데이트
        function updatePreview() {
            const markdown = document.getElementById('splitNotepad').value;
            const previewPane = document.getElementById('previewPane');
            
            // 간단한 마크다운 변환 (실제로는 더 복잡한 라이브러리 사용 권장)
            let html = markdown
                // 헤딩
                .replace(/^# (.*$)/gm, '<h1>$1</h1>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                // 굵게
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // 기울임
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // 밑줄
                .replace(/_(.*?)_/g, '<u>$1</u>')
                // 취소선
                .replace(/~~(.*?)~~/g, '<s>$1</s>')
                // 목록
                .replace(/^-  (.*$)/gm, '<li>$1</li>')
                // 번호 목록 (간단한 구현)
                .replace(/^\d+\. (.*$)/gm, '<li>$1</li>')
                // 색상 태그
                .replace(/<color=([^>]+)>(.*?)<\/color>/g, '<span style="color:$1">$2</span>')
                // 줄바꿈
                .replace(/\n/g, '<br>');
                
            previewPane.innerHTML = html;
        }
        
        // 전체 화면 모드 토글
        function toggleFullscreen() {
            const container = isPreviewMode() ? 
                document.getElementById('previewContainer') : 
                document.getElementById('editContainer');
                
            if (isFullscreen) {
                // 전체 화면 종료
                container.classList.remove('fullscreen');
                document.body.style.overflow = 'auto';
                isFullscreen = false;
            } else {
                // 전체 화면 시작
                container.classList.add('fullscreen');
                document.body.style.overflow = 'hidden';
                isFullscreen = true;
            }
        }
        
        // 단어 수 및 줄 수 업데이트
        function updateWordCount() {
            const text = isPreviewMode() ? 
                document.getElementById('splitNotepad').value : 
                document.getElementById('notepad').value;
                
            const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            const lineCount = text === '' ? 0 : text.split('\n').length;
            
            document.getElementById('wordCount').textContent = 
                `글자 수: ${text.length} | 단어 수: ${wordCount} | 줄 수: ${lineCount}`;
        }
        
        // 새 메모 생성
        function createNewNote() {
            const noteTitle = prompt('새 메모의 제목을 입력하세요:');
            if (!noteTitle) return;
            
            const noteId = 'note_' + Date.now();
            notes[noteId] = {
                title: noteTitle,
                content: '',
                lastModified: new Date().toLocaleString()
            };
            
            currentNoteId = noteId;
            
            // 메모장 비우기
            document.getElementById('notepad').value = '';
            document.getElementById('splitNotepad').value = '';
            
            if (isPreviewMode()) {
                updatePreview();
            }
            
            updateWordCount();
            saveNote();
            updateNoteList();
        }
        
        // 메모 목록 토글
        function toggleNoteList() {
            const noteList = document.getElementById('noteList');
            
            if (noteList.style.display === 'block') {
                noteList.style.display = 'none';
            } else {
                noteList.style.display = 'block';
                updateNoteList();
            }
        }
        
        // 메모 목록 업데이트
        function updateNoteList() {
            const noteList = document.getElementById('noteList');
            noteList.innerHTML = '';
            
            for (const noteId in notes) {
                const note = notes[noteId];
                const noteItem = document.createElement('div');
                noteItem.className = 'note-item';
                noteItem.textContent = note.title || `메모 ${noteId.substring(5)}`;
                noteItem.onclick = function() {
                    loadSpecificNote(noteId);
                };
                
                if (noteId === currentNoteId) {
                    noteItem.style.fontWeight = 'bold';
                }
                
                noteList.appendChild(noteItem);
            }
        }
        
        // 특정 메모 불러오기
        function loadSpecificNote(noteId) {
            if (notes[noteId]) {
                currentNoteId = noteId;
                
                const content = notes[noteId].content;
                document.getElementById('notepad').value = content;
                document.getElementById('splitNotepad').value = content;
                
                if (isPreviewMode()) {
                    updatePreview();
                }
                
                updateWordCount();
                updateNoteList();
            }
        }
        
        // 메모 내용 검색
        function searchText() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                alert('검색어를 입력하세요.');
                return;
            }
            
            const textarea = isPreviewMode() ? 
                document.getElementById('splitNotepad') : 
                document.getElementById('notepad');
                
            const text = textarea.value;
            const index = text.indexOf(searchTerm);
            
            if (index !== -1) {
                textarea.focus();
                textarea.setSelectionRange(index, index + searchTerm.length);
            } else {
                alert('검색 결과가 없습니다.');
            }
        }
        
        // 검색 지우기
        function clearSearch() {
            document.getElementById('searchInput').value = '';
        }
        
        // HTML로 내보내기
        function exportAsHTML() {
            const text = isPreviewMode() ? 
                document.getElementById('splitNotepad').value : 
                document.getElementById('notepad');
                
            if (!text) {
                alert('내보낼 내용이 없습니다.');
                return;
            }
            
            // 간단한 마크다운 변환 (실제로는 더 복잡한 라이브러리 사용 권장)
            let html = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>내보낸 메모</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
    </style>
</head>
<body>
    <div>
        ${text.value
            // 헤딩
            .replace(/^# (.*$)/gm, '<h1>$1</h1>')
            .replace(/^## (.*$)/gm, '<h2>$1</h2>')
            .replace(/^### (.*$)/gm, '<h3>$1</h3>')
            // 굵게
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            // 기울임
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            // 밑줄
            .replace(/_(.*?)_/g, '<u>$1</u>')
            // 취소선
            .replace(/~~(.*?)~~/g, '<s>$1</s>')
            // 목록
            .replace(/^-  (.*$)/gm, '<li>$1</li>')
            // 번호 목록 (간단한 구현)
            .replace(/^\d+\. (.*$)/gm, '<li>$1</li>')
            // 색상 태그
            .replace(/<color=([^>]+)>(.*?)<\/color>/g, '<span style="color:$1">$2</span>')
            // 줄바꿈
            .replace(/\n/g, '<br>')}
    </div>
</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            const filename = prompt('파일 이름을 입력하세요:', 'memo.html');
            if (!filename) return; // 취소 시 중단
            
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // 마크다운으로 내보내기
        function exportAsMarkdown() {
            const text = isPreviewMode() ? 
                document.getElementById('splitNotepad').value : 
                document.getElementById('notepad').value;
                
            if (!text) {
                alert('내보낼 내용이 없습니다.');
                return;
            }
            
            const blob = new Blob([text], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            const filename = prompt('파일 이름을 입력하세요:', 'memo.md');
            if (!filename) return; // 취소 시 중단
            
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // 페이지 로드 시 초기화
        window.onload = function() {
            // 테마 불러오기
            var theme = localStorage.getItem('theme');
            if (theme !== null) {
                changeTheme(theme);
            }
            
            // 메모 불러오기
            loadNote();
            
            // 단어 수 초기화
            updateWordCount();
            
            // 단축키 설정
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey) {
                    switch(e.key) {
                        case 'b': // Ctrl+B: 굵게
                            e.preventDefault();
                            formatText('bold');
                            break;
                        case 'i': // Ctrl+I: 기울임
                            e.preventDefault();
                            formatText('italic');
                            break;
                        case 'u': // Ctrl+U: 밑줄
                            e.preventDefault();
                            formatText('underline');
                            break;
                        case 's': // Ctrl+S: 저장
                            e.preventDefault();
                            saveNote();
                            break;
                        case 'f': // Ctrl+F: 검색
                            e.preventDefault();
                            document.getElementById('searchInput').focus();
                            break;
                        case 'p': // Ctrl+P: 미리보기
                            e.preventDefault();
                            togglePreview();
                            break;
                    }
                } else if (e.key === 'F11') { // F11: 전체 화면
                    e.preventDefault();
                    toggleFullscreen();
                }
            });
            
            // 실행 취소/다시 실행 기능 추가
            document.getElementById('notepad').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'z') {
                    document.execCommand('undo');
                } else if (e.ctrlKey && e.key === 'y') {
                    document.execCommand('redo');
                }
            });
            
            document.getElementById('splitNotepad').addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'z') {
                    document.execCommand('undo');
                } else if (e.ctrlKey && e.key === 'y') {
                    document.execCommand('redo');
                }
            });
        }
    </script>
</body>
</html>
